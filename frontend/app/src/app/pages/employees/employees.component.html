<!-- src/app/pages/employees/employees.component.html -->
<div class="page">

  <!-- ‚îÄ‚îÄ‚îÄ Departments Section ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="section-header">
    <h1 class="page-title">Employees</h1>
    <p class="page-sub">{{ employees().length }} registered employees</p>
  </div>

  @if (error()) {
    <div class="error-msg">{{ error() }}</div>
  }

  <div class="dept-panel">
    <div class="dept-panel-header">
      <span class="dept-label">üè¢ Departments</span>
      <span class="dept-count">{{ departments().length }}</span>
    </div>

    <div class="dept-list">
      @for (dept of departments(); track dept.id) {
        <div class="dept-chip">
          <span>{{ dept.name }}</span>
          <button class="dept-delete" (click)="deleteDepartment(dept.id, dept.name)" title="Delete">√ó</button>
        </div>
      }
      @if (departments().length === 0) {
        <span class="dept-empty">No departments yet.</span>
      }
    </div>

    <div class="dept-add">
      <input
        type="text"
        placeholder="New department name..."
        [value]="newDeptName()"
        (input)="onNewDeptChange($event)"
        (keydown)="onDeptKeyDown($event)"
      />
      <button class="btn-add-dept" (click)="addDepartment()" [disabled]="deptSaving() || !newDeptName().trim()">
        {{ deptSaving() ? 'Adding...' : '+ Add' }}
      </button>
    </div>

    @if (deptMsg()) {
      <div class="dept-msg" [class.dept-msg-error]="deptError()">{{ deptMsg() }}</div>
    }
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ Employees Table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  @if (loading()) {
    <div class="loading">Loading employees...</div>
  } @else if (employees().length === 0) {
    <div class="empty">No employees found. Upload a CSV to register employees automatically.</div>
  } @else {
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>EMPLOYEE</th>
            <th>DEPARTMENT</th>
            <th>TYPE</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody>
          @for (emp of employees(); track emp.id; let i = $index) {
            <tr>
              <td class="row-num">{{ i + 1 }}</td>
              <td>
                <div class="emp-name">{{ emp.name }}</div>
                <div class="emp-id">ID: {{ emp.id }}</div>
              </td>

              @if (isEditing(emp.id)) {
                <td>
                  <select class="inline-select" [value]="getEditDeptId(emp.id) ?? ''" (change)="onDeptChange(emp.id, $event)">
                    <option value="">‚Äî Unassigned ‚Äî</option>
                    @for (dept of departments(); track dept.id) {
                      <option [value]="dept.id">{{ dept.name }}</option>
                    }
                  </select>
                </td>
                <td>
                  <select class="inline-select" [value]="getEditType(emp.id)" (change)="onTypeChange(emp.id, $event)">
                    <option value="permanent">Permanent</option>
                    <option value="cos">COS</option>
                  </select>
                </td>
                <td class="td-actions">
                  <button class="btn-save" (click)="saveEdit(emp)" [disabled]="isSaving(emp.id)">
                    {{ isSaving(emp.id) ? 'Saving...' : '‚úì Save' }}
                  </button>
                  <button class="btn-cancel" (click)="cancelEdit(emp.id)">Cancel</button>
                </td>
              } @else {
                <td>
                  <span class="dept-badge">{{ emp.department ?? '‚Äî' }}</span>
                </td>
                <td>
                  <span class="type-badge" [class.type-cos]="emp.employee_type === 'cos'">
                    {{ emp.employee_type === 'cos' ? 'COS' : 'Permanent' }}
                  </span>
                </td>
                <td class="td-actions">
                  <button class="btn-edit" (click)="startEdit(emp)">‚úé Edit</button>
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>