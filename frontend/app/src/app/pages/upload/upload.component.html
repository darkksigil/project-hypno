<!-- src/app/pages/upload/upload.component.html -->
<div class="page">
  
  <div class="page-header">
    <h1 class="page-title">Upload CSV</h1>
    <p class="page-sub">Import punch logs from biometric device export</p>
  </div>

  @if (!showPreview()) {
    <!-- Step 1: File Selection with Drag & Drop -->
    <div class="upload-card">
      <div 
        class="upload-zone" 
        [class.dragging]="dragOver()"
        (click)="fileInput.click()"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
      >
        <div class="upload-icon">
          {{ dragOver() ? 'üì•' : 'üìÅ' }}
        </div>
        <p class="upload-label">
          {{ dragOver() ? 'Drop CSV file here' : 'Click or drag CSV file to upload' }}
        </p>
        <p class="upload-hint">Supports employee_id, name, timestamp format</p>
        
        <input 
          #fileInput
          type="file" 
          accept=".csv" 
          (change)="onFileSelect($event)" 
          class="file-input"
        />
      </div>

      @if (uploading()) {
        <div class="loading-bar">
          <div class="loading-spinner"></div>
          <span>Parsing CSV file...</span>
        </div>
      }

      @if (error()) {
        <div class="alert alert-error">{{ error() }}</div>
      }

      @if (success() && !showPreview()) {
        <div class="alert alert-success">{{ success() }}</div>
      }
    </div>
  }

  @if (showPreview()) {
    <!-- Step 2: Preview & Confirm -->
    <div class="preview-card">
      <div class="preview-header">
        <div>
          <h2 class="preview-title">Preview Parsed Data</h2>
          <p class="preview-sub">{{ previewData().length }} punch records ready to upload</p>
        </div>
        <div class="preview-actions">
          <button class="btn-cancel" (click)="cancelPreview()">‚úï Cancel</button>
          <button 
            class="btn-confirm" 
            (click)="confirmUpload()" 
            [disabled]="confirming()"
          >
            {{ confirming() ? '‚è≥ Uploading...' : '‚úì Confirm & Upload' }}
          </button>
        </div>
      </div>

      @if (error()) {
        <div class="alert alert-error">{{ error() }}</div>
      }

      @if (success()) {
        <div class="alert alert-success">{{ success() }}</div>
      }

      <!-- Preview Table -->
      <div class="table-wrap">
        <table class="preview-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Employee ID</th>
              <th>Name</th>
              <th>Punched At</th>
            </tr>
          </thead>
          <tbody>
            @for (punch of previewData(); track $index) {
              <tr>
                <td class="td-num">{{ $index + 1 }}</td>
                <td class="td-id">{{ punch.employee_id }}</td>
                <td class="td-name">{{ punch.name }}</td>
                <td class="td-time">{{ formatTimestamp(punch.punched_at) }}</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }

</div>